import { mock } from 'jest-mock-extended';
import { MalwareEvolutionRepository } from '../../../../contexts/malware-evolution/domain/contracts/malware-evolution.repository';
import { UseCase } from '../../../../contexts/shared/application/use-case';
import { MalwareEvolution } from '../../../../contexts/malware-evolution/domain/models/malware-evolution.entity';
import { MalwareEvolutionBuilder } from '../__mocks__/malware-evolution.builder';
import { findByWeekBuilder } from '../../../../contexts/malware-evolution/application/find-by-week.usecase';

describe('Find all malware evolution data usecase', () => {
  const mockMalwareEvolutionRepository = mock<MalwareEvolutionRepository>();

  let findByWeek: UseCase<void, MalwareEvolution[]>;
  let validMalwareEvolutions: MalwareEvolution[];

  beforeAll(() => {
    validMalwareEvolutions = [MalwareEvolutionBuilder().build()];

    findByWeek = findByWeekBuilder({
      malwareEvolutionRepository: mockMalwareEvolutionRepository
    });
  });

  it('It should return malware evolution data grouped by week', async () => {
    mockMalwareEvolutionRepository.findByWeek.mockResolvedValue(validMalwareEvolutions);

    const result = await findByWeek();

    expect(mockMalwareEvolutionRepository.findByWeek).toBeCalled();
    expect(result).not.toBeNull();
    expect(result).toHaveLength(1);
  });
});
