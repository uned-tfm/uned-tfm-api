import { mock } from 'jest-mock-extended';
import { UseCase } from '../../../../contexts/shared/application/use-case';
import { FileFeatureRepository } from '../../../../contexts/file-features/domain/contracts/file-feature.repository';
import { FileFeature } from '../../../../contexts/file-features/domain/models/file-feature.entity';
import { FileFeatureBuilder } from '../__mocks__/file-feature.builder';
import { findByMalwareAndFileTypeBuilder } from '../../../../contexts/file-features/application/find-by-malware-and-file-type.usecase';

describe('Find all file feature by malware and file type data usecase', () => {
  const mockFileFeatureRepository = mock<FileFeatureRepository>();

  let findByMalwareAndFileType: UseCase<void, FileFeature[]>;
  let validFileFeatures: FileFeature[];

  beforeAll(() => {
    validFileFeatures = [FileFeatureBuilder().build()];

    findByMalwareAndFileType = findByMalwareAndFileTypeBuilder({
      fileFeatureRepository: mockFileFeatureRepository
    });
  });

  it('It should return file feature data grouped by malware and file type', async () => {
    mockFileFeatureRepository.findByMalwareAndFileType.mockResolvedValue(validFileFeatures);

    const result = await findByMalwareAndFileType();

    expect(mockFileFeatureRepository.findByMalwareAndFileType).toBeCalled();
    expect(result).not.toBeNull();
    expect(result).toHaveLength(1);
  });
});
