import { mock } from 'jest-mock-extended';
import { UseCase } from '../../../../contexts/shared/application/use-case';
import { FileFeatureRepository } from '../../../../contexts/file-features/domain/contracts/file-feature.repository';
import { FileFeature } from '../../../../contexts/file-features/domain/models/file-feature.entity';
import { FileFeatureBuilder } from '../__mocks__/file-feature.builder';
import { findAvgByMalwareTypeBuilder } from '../../../../contexts/file-features/application/find-avg-by-malware-type.usecase';

describe('Find all file feature by malware type data usecase', () => {
  const mockFileFeatureRepository = mock<FileFeatureRepository>();

  let findAvgByMalwareType: UseCase<void, FileFeature[]>;
  let validFileFeatures: FileFeature[];

  beforeAll(() => {
    validFileFeatures = [FileFeatureBuilder().build()];

    findAvgByMalwareType = findAvgByMalwareTypeBuilder({
      fileFeatureRepository: mockFileFeatureRepository
    });
  });

  it('It should return file feature data grouped by malware type', async () => {
    mockFileFeatureRepository.findAvgByMalwareType.mockResolvedValue(validFileFeatures);

    const result = await findAvgByMalwareType();

    expect(mockFileFeatureRepository.findAvgByMalwareType).toBeCalled();
    expect(result).not.toBeNull();
    expect(result).toHaveLength(1);
  });
});
