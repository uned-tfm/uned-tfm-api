import { mock } from 'jest-mock-extended';
import { UseCase } from '../../../../contexts/shared/application/use-case';
import { MalwareTypeRepository } from '../../../../contexts/malware-types/domain/contracts/malware-type.repository';
import { MalwareType } from '../../../../contexts/malware-types/domain/models/malware-type.entity';
import { MalwareTypeBuilder } from '../__mocks__/malware-type.builder';
import { findByMalwareTypeBuilder } from '../../../../contexts/malware-types/application/find-by-malware-type.usecase';

describe('Find all malware type data usecase', () => {
  const mockMalwareTypeRepository = mock<MalwareTypeRepository>();

  let findByMalwareType: UseCase<void, MalwareType[]>;
  let validMalwareTypes: MalwareType[];

  beforeAll(() => {
    validMalwareTypes = [MalwareTypeBuilder().build()];

    findByMalwareType = findByMalwareTypeBuilder({
      malwareTypeRepository: mockMalwareTypeRepository
    });
  });

  it('It should return malware type data grouped by malware type', async () => {
    mockMalwareTypeRepository.findByMalwareType.mockResolvedValue(validMalwareTypes);

    const result = await findByMalwareType();

    expect(mockMalwareTypeRepository.findByMalwareType).toBeCalled();
    expect(result).not.toBeNull();
    expect(result).toHaveLength(1);
  });
});
